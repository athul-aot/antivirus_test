##
## Updated ClamAV Daemon Configuration (optimized for Docker)
## Version: Custom for clamav/clamav:1.3
##

# Logging
LogFile /var/log/clamav/clamd.log
LogTime yes
LogVerbose yes
ExtendedDetectionInfo yes

# TCP socket for Docker access
TCPSocket 3310
# Uncomment this if needed externally
# TCPAddr 0.0.0.0

# Run as clamav user inside container
User clamav

# --- Enable All Important Scanning Modules ---
ScanArchive yes
ScanOLE2 yes
ScanPDF yes
ScanSWF yes
ScanXMLDOCS yes
ScanHWP3 yes
ScanOneNote yes
ScanMail yes
ScanPE yes
ScanELF yes
ScanHTML yes

# --- Advanced Detection Options ---
DetectPUA yes
AlertEncrypted yes
AlertEncryptedArchive yes
AlertEncryptedDoc yes
FollowDirectorySymlinks yes
FollowFileSymlinks yes
DetectBrokenExecutables yes
HeuristicAlerts yes
HeuristicScanPrecedence no

# --- Security & Performance ---
MaxScanSize 1000M
MaxFileSize 400M
MaxRecursion 20
MaxFiles 20000
MaxEmbeddedPE 100M
MaxHTMLNormalize 100M
MaxHTMLNoTags 16M
MaxScriptNormalize 50M
MaxScanTime 300000

# --- Cache and Engine ---
Bytecode yes
BytecodeSecurity TrustSigned

# --- Optional Logging Enhancements ---
LogRotate yes
LogClean no
# Save temp files for debugging (optional)
# LeaveTemporaryFiles yes

# --- Misc Settings ---
FollowDirectorySymlinks yes
FollowFileSymlinks yes
CrossFilesystems yes

# --- On-access scanning (disabled in Docker by default) ---
# OnAccessMaxFileSize 10M
# OnAccessIncludePath /scandir

# --- Disable example restriction ---
# Example

# --- Socket paths (default for clamd service) ---
LocalSocket /tmp/clamd.sock
FixStaleSocket yes

# --- Limits and Safety ---
AlertExceedsMax yes
ExitOnOOM yes
